
  <div class="accordion-question">
    {{#sections}}
     <div class="accordion-section" data-index="{{@index}}">
        <div class="accordion-header">
          {{title}}
        </div>

        <div class="accordion-body">
          {{#questions}}
            {{> partials/accQuestion }}
          {{/questions}}
        </div>
      </div>
    {{/sections}}
  </div>


<script>
/*document.querySelectorAll('.accordion-header').forEach(header => {
  header.addEventListener('click', () => {
     const body = header.nextElementSibling;
    const section = header.parentElement;

    // fermer toutes les autres sections
    document.querySelectorAll('.accordion-section').forEach(sec => {
      if (sec !== section) {
        sec.querySelector('.accordion-header').classList.remove('open');
        sec.querySelector('.accordion-body').classList.remove('open');
      }
    });

   // basculer la section cliquée
    header.classList.toggle('open');
    body.classList.toggle('open');
  });
});*/
document.addEventListener('DOMContentLoaded', () => {
  const sections = document.querySelectorAll('.accordion-section');

  if (!sections.length) return;

  // 1️⃣ Ouvrir la première par défaut
  const openSection = (section) => {
    const header = section.querySelector('.accordion-header');
    const body = section.querySelector('.accordion-body');
    header.classList.add('open');
    body.classList.add('open');
  };

  const closeSection = (section) => {
    const header = section.querySelector('.accordion-header');
    const body = section.querySelector('.accordion-body');
    header.classList.remove('open');
    body.classList.remove('open');
  };

  openSection(sections[0]);

  // 2️⃣ Clic manuel pour ouvrir/fermer
  sections.forEach(section => {
    const header = section.querySelector('.accordion-header');
    const body = section.querySelector('.accordion-body');

    header.addEventListener('click', () => {
      const isOpen = header.classList.contains('open');

      if (isOpen) {
        closeSection(section);
      } else {
        // fermer toutes les autres
        sections.forEach(sec => closeSection(sec));
        openSection(section);
      }
    });
  });

  // 3️⃣ Auto-avancement quand toutes les questions d’une section sont remplies
  const isSectionComplete = (section) => {
    const inputs = section.querySelectorAll('input, select, textarea');
    for (const input of inputs) {
      if (input.type === 'checkbox' || input.type === 'radio') {
        const name = input.name;
        const checked = section.querySelectorAll(`input[name="${name}"]:checked`);
        if (!checked.length) return false;
      } else if (!input.value) {
        return false;
      }
    }
    return true;
  };

  sections.forEach((section, index) => {
    const inputs = section.querySelectorAll('input, select, textarea');
    inputs.forEach(input => {
      input.addEventListener('change', () => {
        if (isSectionComplete(section)) {
          // fermer section actuelle
          closeSection(section);

          // ouvrir suivante si elle existe
          const nextSection = sections[index + 1];
          if (nextSection) {
            openSection(nextSection);
            nextSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        }
      });
    });
  });
});

</script>
